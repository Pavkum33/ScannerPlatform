<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern Scanner Pro - Advanced Trading Analytics Platform</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@latest/dist/apexcharts.css">
</head>
<body data-theme="light">
    <!-- Top Bar -->
    <header class="top-bar">
        <div class="top-bar-left">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="market-status">
                <span class="market-indicator" id="marketIndicator"></span>
                <span class="market-text" id="marketStatus">Market Closed</span>
                <span class="market-time" id="marketTime"></span>
            </div>
        </div>
        <div class="top-bar-right">
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>
            <div class="notifications">
                <button class="notification-btn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount">0</span>
                </button>
            </div>
            <div class="user-menu">
                <img src="https://ui-avatars.com/api/?name=Trader&background=7c3aed&color=fff" alt="User" class="user-avatar">
                <span class="user-name">Pro Trader</span>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </header>

    <div class="app-wrapper">
        <!-- Enhanced Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="logo-info">
                        <h2>Pattern Scanner</h2>
                        <span class="version">Pro v2.0</span>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">
                        <span>MAIN MENU</span>
                    </div>
                    <ul class="nav-list">
                        <li class="nav-item active">
                            <a href="#" class="nav-link">
                                <div class="nav-icon">
                                    <i class="fas fa-tachometer-alt"></i>
                                </div>
                                <span class="nav-text">Dashboard</span>
                                <span class="nav-badge pulse">Live</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <div class="nav-icon">
                                    <i class="fas fa-chart-area"></i>
                                </div>
                                <span class="nav-text">Market Overview</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <div class="nav-icon">
                                    <i class="fas fa-history"></i>
                                </div>
                                <span class="nav-text">Scan History</span>
                                <span class="nav-count">12</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">
                        <span>PATTERN SCANNERS</span>
                    </div>
                    <ul class="nav-list">
                        <li class="nav-item scanner-item active" data-scanner="marubozu_doji">
                            <a href="#" class="nav-link">
                                <div class="nav-icon">
                                    <i class="fas fa-chart-candlestick"></i>
                                </div>
                                <span class="nav-text">Marubozu + Doji</span>
                                <span class="nav-status active">Active</span>
                            </a>
                        </li>
                        <li class="nav-item scanner-item disabled" data-scanner="hammer">
                            <a href="#" class="nav-link">
                                <div class="nav-icon">
                                    <i class="fas fa-hammer"></i>
                                </div>
                                <span class="nav-text">Hammer Pattern</span>
                                <span class="nav-status coming">Soon</span>
                            </a>
                        </li>
                        <li class="nav-item scanner-item disabled" data-scanner="engulfing">
                            <a href="#" class="nav-link">
                                <div class="nav-icon">
                                    <i class="fas fa-compress-arrows-alt"></i>
                                </div>
                                <span class="nav-text">Engulfing</span>
                                <span class="nav-status coming">Soon</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">
                        <span>SETTINGS</span>
                    </div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <div class="nav-icon">
                                    <i class="fas fa-cog"></i>
                                </div>
                                <span class="nav-text">Preferences</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">
                                <div class="nav-icon">
                                    <i class="fas fa-database"></i>
                                </div>
                                <span class="nav-text">Data Management</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="connection-card">
                    <div class="connection-header">
                        <span class="connection-dot online"></span>
                        <span class="connection-text">DHAN API</span>
                    </div>
                    <div class="connection-stats">
                        <div class="stat-item">
                            <span class="stat-value">158</span>
                            <span class="stat-label">Symbols</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">3/s</span>
                            <span class="stat-label">Rate</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-title-section">
                    <h1 class="page-title">
                        <span class="title-icon">
                            <i class="fas fa-chart-candlestick"></i>
                        </span>
                        Marubozu + Doji Scanner
                    </h1>
                    <p class="page-subtitle">Advanced pattern detection for failed breakout signals</p>
                </div>
                <div class="page-actions">
                    <button class="action-btn secondary" onclick="runEODUpdate()">
                        <i class="fas fa-cloud-download-alt"></i>
                        <span>EOD Update</span>
                    </button>
                    <button class="action-btn secondary" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh</span>
                    </button>
                    <div class="export-dropdown">
                        <button class="action-btn secondary dropdown-trigger">
                            <i class="fas fa-download"></i>
                            <span>Export</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" onclick="exportResults('json')">
                                <i class="fas fa-code"></i> Export as JSON
                            </a>
                            <a href="#" onclick="exportResults('csv')">
                                <i class="fas fa-file-csv"></i> Export as CSV
                            </a>
                            <a href="#" onclick="exportResults('excel')">
                                <i class="fas fa-file-excel"></i> Export as Excel
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats Dashboard -->
            <div class="stats-dashboard">
                <div class="stat-card gradient-1">
                    <div class="stat-card-body">
                        <div class="stat-icon-wrapper">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="stat-details">
                            <h3 class="stat-value" id="totalScans">0</h3>
                            <p class="stat-label">Total Scans</p>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>12% from last</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-chart" id="scansChart"></div>
                </div>

                <div class="stat-card gradient-2">
                    <div class="stat-card-body">
                        <div class="stat-icon-wrapper">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="stat-details">
                            <h3 class="stat-value" id="symbolsScanned">0</h3>
                            <p class="stat-label">Symbols Scanned</p>
                            <div class="stat-progress">
                                <div class="progress-bar-mini">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-chart" id="symbolsChart"></div>
                </div>

                <div class="stat-card gradient-3">
                    <div class="stat-card-body">
                        <div class="stat-icon-wrapper">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-details">
                            <h3 class="stat-value" id="patternsFound">0</h3>
                            <p class="stat-label">Patterns Found</p>
                            <div class="stat-badges">
                                <span class="mini-badge bullish">0 Bull</span>
                                <span class="mini-badge bearish">0 Bear</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-chart" id="patternsChart"></div>
                </div>

                <div class="stat-card gradient-4">
                    <div class="stat-card-body">
                        <div class="stat-icon-wrapper">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-details">
                            <h3 class="stat-value" id="scanTime">0s</h3>
                            <p class="stat-label">Scan Time</p>
                            <div class="stat-indicator">
                                <span class="indicator-dot fast"></span>
                                <span>Fast Performance</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-chart" id="timeChart"></div>
                </div>
            </div>

            <!-- Scanner Controls -->
            <div class="scanner-panel">
                <div class="panel-header">
                    <h2 class="panel-title">
                        <i class="fas fa-sliders-h"></i>
                        Scanner Configuration
                    </h2>
                    <button class="panel-toggle" onclick="togglePanel(this)">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>

                <div class="panel-body">
                    <div class="controls-grid">
                        <div class="control-card">
                            <label class="control-label">
                                <i class="fas fa-calendar-alt"></i>
                                Timeframe
                            </label>
                            <select id="timeframe" class="control-select">
                                <option value="1D" selected>Daily (1D)</option>
                                <option value="1W">Weekly (1W)</option>
                                <option value="1M">Monthly (1M)</option>
                            </select>
                            <span class="control-hint">Select analysis timeframe</span>
                        </div>

                        <div class="control-card">
                            <label class="control-label">
                                <i class="fas fa-percentage"></i>
                                Min Marubozu Body
                            </label>
                            <div class="slider-container">
                                <input type="range" id="minBodyMoveSlider" class="control-slider"
                                       min="1" max="10" step="0.5" value="2"
                                       oninput="updateSliderValue('minBodyMove', this.value)">
                                <div class="slider-value">
                                    <input type="number" id="minBodyMove" class="control-input"
                                           value="2" min="1" max="10" step="0.5"
                                           oninput="updateSliderValue('minBodyMoveSlider', this.value)">
                                    <span class="input-unit">%</span>
                                </div>
                            </div>
                            <span class="control-hint">Minimum body size threshold</span>
                        </div>

                        <div class="control-card">
                            <label class="control-label">
                                <i class="fas fa-history"></i>
                                History Periods
                            </label>
                            <div class="input-group">
                                <input type="number" id="daysBack" class="control-input" value="30" min="10" max="365">
                                <span class="input-addon" id="historyUnit">days</span>
                            </div>
                            <span class="control-hint" id="historyHelp">Number of trading days to analyze</span>
                        </div>

                        <div class="control-card">
                            <label class="control-label">
                                <i class="fas fa-layer-group"></i>
                                Symbol Group
                            </label>
                            <select id="symbolGroup" class="control-select" onchange="onSymbolGroupChange()">
                                <option value="fno">F&O Stocks (158)</option>
                                <option value="nifty50">Nifty 50</option>
                                <option value="custom">Custom Symbols</option>
                            </select>
                            <span class="control-hint">Select stock universe</span>
                        </div>
                    </div>

                    <div class="custom-symbols-panel" id="customSymbolsSection" style="display:none;">
                        <label class="control-label">
                            <i class="fas fa-edit"></i>
                            Custom Symbols
                        </label>
                        <textarea id="customSymbols" class="control-textarea"
                                  placeholder="Enter symbols separated by commas&#10;Example: RELIANCE, TCS, INFY, HDFCBANK"
                                  rows="3"></textarea>
                    </div>

                    <div class="action-panel">
                        <button class="action-btn primary large" onclick="startScan()" id="scanButton">
                            <span class="btn-icon">
                                <i class="fas fa-search"></i>
                            </span>
                            <span class="btn-text">Start Full Scan</span>
                            <span class="btn-loader" style="display:none;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </span>
                        </button>
                        <button class="action-btn success large" onclick="startTodayScan()">
                            <span class="btn-icon">
                                <i class="fas fa-calendar-day"></i>
                            </span>
                            <span class="btn-text">Today's Signals</span>
                        </button>
                        <button class="action-btn info large" onclick="loadDatabasePatterns()">
                            <span class="btn-icon">
                                <i class="fas fa-database"></i>
                            </span>
                            <span class="btn-text">Load All Patterns</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Progress Section -->
            <div class="progress-panel" id="progressSection" style="display:none;">
                <div class="progress-content">
                    <div class="progress-animation">
                        <div class="scanner-animation">
                            <div class="scan-line"></div>
                            <div class="scan-dots">
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                    </div>
                    <div class="progress-details">
                        <h3 class="progress-title">Scanning in Progress</h3>
                        <p class="progress-message" id="progressText">Initializing scanner...</p>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar-track">
                                <div class="progress-bar-fill" id="progressBar"></div>
                            </div>
                            <span class="progress-percentage" id="progressPercent">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-panel">
                <div class="panel-header">
                    <div class="results-title">
                        <h2>
                            <i class="fas fa-chart-line"></i>
                            Pattern Results
                            <span class="results-count" id="patternCount">0</span>
                        </h2>
                    </div>
                    <div class="results-filters">
                        <div class="filter-group">
                            <button class="filter-btn active" onclick="filterResults('all')">
                                <i class="fas fa-th"></i> All
                            </button>
                            <button class="filter-btn" onclick="filterResults('bullish')">
                                <i class="fas fa-arrow-up"></i> Bullish
                            </button>
                            <button class="filter-btn" onclick="filterResults('bearish')">
                                <i class="fas fa-arrow-down"></i> Bearish
                            </button>
                            <button class="filter-btn" onclick="filterResults('today')">
                                <i class="fas fa-star"></i> Today
                            </button>
                        </div>
                        <div class="view-toggles">
                            <button class="view-btn active" onclick="setView('cards')">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" onclick="setView('table')">
                                <i class="fas fa-table"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="results-container" id="resultsContainer">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-chart-candlestick"></i>
                        </div>
                        <h3 class="empty-title">No Patterns Detected Yet</h3>
                        <p class="empty-text">Configure your scanner settings and click "Start Full Scan" to begin pattern detection</p>
                        <button class="action-btn primary" onclick="document.getElementById('scanButton').click()">
                            <i class="fas fa-play"></i> Start Scanning
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Enhanced Toast Notifications -->
    <div class="toast-container">
        <div class="toast" id="toast">
            <div class="toast-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="toast-body">
                <h4 class="toast-title">Success</h4>
                <p class="toast-message" id="toastMessage">Operation completed successfully</p>
            </div>
            <button class="toast-close" onclick="hideToast()">
                <i class="fas fa-times"></i>
            </button>
            <div class="toast-progress"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest/dist/apexcharts.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>